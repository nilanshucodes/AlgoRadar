{% extends "base.html" %}
{% block title %}AlgoRadar{% endblock %}
{% block content %}
{% set platform_logos = {
    'codeforces.com': url_for('static', filename='images/codeforces.png'),
    'codechef.com': url_for('static', filename='images/codechef.png'),
    'atcoder.jp': url_for('static', filename='images/atcoder.png'),
    'leetcode.com': url_for('static', filename='images/leetcode.png')
} %}


<div class="container my-4">
    <h2 class="mb-3 text-center">UPCOMING CONTESTS</h2>


    <!-- Filters -->
    <form method="get" class="mb-3">
        <div class="d-flex flex-wrap gap-2">
            <label><input type="checkbox" name="platform" value="codeforces.com" {% if 'codeforces.com' in platforms %}checked{% endif %}> Codeforces</label>
            <label><input type="checkbox" name="platform" value="atcoder.jp" {% if 'atcoder.jp' in platforms %}checked{% endif %}> AtCoder</label>
            <label><input type="checkbox" name="platform" value="leetcode.com" {% if 'leetcode.com' in platforms %}checked{% endif %}> LeetCode</label>
            <label><input type="checkbox" name="platform" value="codechef.com" {% if 'codechef.com' in platforms %}checked{% endif %}> CodeChef</label>
            <label><input type="checkbox" name="platform" value="" {% if not platforms %}checked{% endif %}> All Contests</label>
        </div>
        <div class="mt-2">
            <select name="time" class="form-select w-auto d-inline">
                <option value="">All Time</option>
                <option value="today" {% if time_filter == 'today' %}selected{% endif %}>Today</option>
                <option value="week" {% if time_filter == 'week' %}selected{% endif %}>This Week</option>
                <option value="month" {% if time_filter == 'month' %}selected{% endif %}>This Month</option>
            </select>
            <button type="submit" class="btn btn-primary btn-sm">Apply</button>
        </div>
    </form>

    <button id="switchBtn">Switch to Card View</button>

    <!-- Table -->
    <table id="contestTable" class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Platform</th>
                <th>Contest</th>
                <th>Date</th>
                <th>Start</th>
                <th>End</th>
                <th>Link</th>
            </tr>
        </thead>
        <tbody>
            {% for contest in contests %}
            <tr>
                <td>
                    {% if contest.resource in platform_logos %}
                         <img src="{{ platform_logos[contest.resource] }}" alt="{{ contest.resource }}" class="table-logo">
                    {% endif %}
                    {{ contest.resource }}
                </td>
                <td>{{ contest.event }}</td>
                <td>{{ contest.start_date }}</td>
                <td> {{ contest.start_time }}</td>
                <td>{{ contest.end_ist }}</td>
                <td><a href="{{ contest.href }}" target="_blank" class="btn btn-sm btn-outline-primary">Visit</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Card view -->
    <div class="card-container" id="cardContainer">
        {% for c in contests %}
            {% if c.resource in ['codeforces.com','codechef.com','atcoder.jp','leetcode.com'] or c.resource in platforms %}
            <div class="contest-card platform-{{ c.resource.split('.')[0] }}" onclick="window.open('{{ c.href }}', '_blank')">
                <h3>{{ c.event }}</h3>
                <p>{{ c.start_date }} | {{ c.start_time }} - {{ c.end_ist }}</p>
            </div>
            {% endif %}
        {% endfor %}
    </div>

    <script>
        const switchBtn = document.getElementById("switchBtn");
        const table = document.getElementById("contestTable");
        const cards = document.getElementById("cardContainer");
        let tableView = true;

        switchBtn.addEventListener("click", () => {
            if(tableView){
                table.style.display = "none";
                cards.style.display = "flex";
                switchBtn.textContent = "Switch to Table View";
            } else {
                table.style.display = "table";
                cards.style.display = "none";
                switchBtn.textContent = "Switch to Card View";
            }
            tableView = !tableView;
        });
    </script>
</div>
{% endblock %}
